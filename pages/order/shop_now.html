<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../../asset/css/shop_now.css">
</head>

<body>
    <main>
        <form id="form">
        <div class="container">
            <!--shipping address-->
            <h1>Shipping Address</h1>
            <div class="label">
                <div class="input">
                    <label for="name">Name</label>
                    <input type="text" name="name" id="username" required
                        title="username is cannot contain space or only minimum 2" pattern="^[a-zA-Z ]{3,50}$">
                </div>
                <div class="input">
                    <label for="email">Email</label>
                    <input type="email" name="email" id="email"
                        pattern="^[a-zA-Z0-9][a-zA-Z0-9._%+-]*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                        title="please required formet" required>
                </div>
                <div class="input">
                    <label for="country">Country</label>
                    <input type="text" name="country" id="country_name" required
                        title="country name is cannot contain space" pattern="^[a-zA-Z ]{3,50}$">
                </div>
                <div class="input">
                    <label for="address">Address</label>
                    <input type="text" name="address" id="address" required>
                </div>
                <div class="input">
                    <label for="phone">Phone</label>
                    <input type="number" name="phone" id="phone" required
                        title="Phone number is cannot contain space or  minimum 10 maximum 12" maxlength="12"
                        minlength="10">
                </div>
                <div class="input">
                    <label for="pincode">Pincode</label>
                    <input type="number" name="pincode" id="pincode" required
                        title="pincode is cannot contain space or  put 6 digits" maxlength="6" minlength="6">
                </div>
                <div class="checkbox">
                    <input type="checkbox" name="save" id="save" required>
                    <label for="save">Save Information</label>
                </div>
            </div>
            <!--shipping address end-->
            <!--payment start-->
                <div class="payment">
                    <h2>Payment</h2>
                    <div class="payment_img">
                        <input type="radio" name="payment" id="cash_on_delivery" class="payment_option" value="cash_delivery">
                        <label for="cash">Cash On Delivery</label>
                        <input type="radio" name="payment" id="card" class="payment_option" value="card_option">
                        <label for="cash">Card</label>
                    </div>
                    <!--payment end-->
                </div>

        </div>
      <button type="submit" id="btn">Place Order</button>
        </form>
    </main>
    <script>

// let btn = document.getElementById("btn")
// btn.addEventListener("click", function(){
//     window.location.href = "../order/placeorder.html?id=" + search_value
// })

        let profile = JSON.parse(localStorage.getItem('get'));
        let active_user = JSON.parse(localStorage.getItem('active_user'));
        console.log(profile);
        for (let i = 0; i < profile.length; i++) {
            document.getElementById("username").value = profile[i]["user_name"];
            document.getElementById("email").value = profile[i]["email"];
            document.getElementById("address").value = profile[i]["address"];
            document.getElementById("phone").value = profile[i]["phone"];
            document.getElementById("country_name").value = profile[i]["Country"];
            document.getElementById("pincode").value = profile[i]["Pincode"];

        }
        let newdate;
        let dateObj = new Date();
        let month = dateObj.getUTCMonth() + 1; //months from 1-12
        let day = dateObj.getUTCDate();
        let year = dateObj.getUTCFullYear();
        newdate = day + "/" + month + "/" + year;
        console.log(newdate);
        // orders id code
        let order_id = Date.now();
        console.log(order_id);
        let specs = JSON.parse(localStorage.getItem("create_specs"));


        const url = window.location.search;
        console.log(url);
        const params = new URLSearchParams(url);
        console.log(params);
        const search_value = params.get("id");
        console.log(search_value);
        let result;
        let product;
        let specs_find = specs.find(function (e) {
            if (e["product_id"] == search_value) {
                product = e;
                return (result = e);
            } else {
                return (result = 0);
            }
        });
        console.log(product);
        let form = document.getElementById("form");
        form.addEventListener("submit", function (e) {
            e.preventDefault();
            let payment_option = document.querySelector(".payment_option:checked").value;
            console.log(payment_option);
            let user = JSON.parse(localStorage.getItem("active_user"));
            let order = JSON.parse(localStorage.getItem("order")) ?? [];
            let obj = {};

        
            obj["image"] = product["image"];
            obj["rupees"] = product["rupees"];
            obj["desc"] = product["desc"];
            obj["product_id"] = product["product_id"];
            obj["title"] = product["title"];
            obj["order_id"] = order_id;
            obj["order_date"] = newdate;
            obj["payment_option"] = payment_option;
            obj["email"] = user["email"];
            order.push(obj);
            localStorage.setItem("order", JSON.stringify(order));
            window.location.href = "../../pages/order/placeorder.html";
        });


    </script>
</body>

</html>